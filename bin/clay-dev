#!/usr/bin/env bash

# Determine the directory where this script lives, following symlinks
# This is important for npm link to work correctly
SCRIPT_PATH="${BASH_SOURCE[0]}"
while [ -L "$SCRIPT_PATH" ]; do
  SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
  SCRIPT_PATH="$(readlink "$SCRIPT_PATH")"
  [[ $SCRIPT_PATH != /* ]] && SCRIPT_PATH="$SCRIPT_DIR/$SCRIPT_PATH"
done
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# Check if we're in development mode (TypeScript source exists)
if [ -f "$PROJECT_ROOT/index.ts" ]; then
  # Development mode: use ts-node
  exec node --require ts-node/register --require tsconfig-paths/register "$PROJECT_ROOT/index.ts" "$@"
else
  # Production mode: use compiled JavaScript
  exec node "$PROJECT_ROOT/dist/index.js" "$@"
fi
